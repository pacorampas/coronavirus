<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>

  <link rel="stylesheet" type="text/css" href="styles.css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,800&display=swap" rel="stylesheet">

  <script>

    const CONFIG = {
      apiKey: 'AIzaSyAfza9Un8Yty7n1uH5HWLj9idSwR7fhyEU',
      authDomain: 'coronavirus-76dc1.firebaseapp.com',
      // databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,
      // storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,
      projectId: 'coronavirus-76dc1',
      // messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID
    }

    var app = firebase.initializeApp(CONFIG)
    
    app.auth().signInAnonymously().catch(function(error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
      // ...
    });
  </script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coronavirus test</title>
</head>
<body class="test">
  <h1>Test de huella<br />dactilar</h1>
  <div>
    <p>Manten el dedo sobre la huella hasta que acabe la cuenta atr√°s (<strong><span id="count-down"></span></strong>)</p>
    <p class="info"><i>Activa el sonido para una experiencia completa</i></p>
  </div>
  <div class="test-content">
    <div id="finger-box-wrapper">
      <div id="finger-box">
        <div class="finger-print"></div>
      </div>
    </div>
    <audio id="machine-sound" src="machine-sound.mp3"></audio>
  </div>
  <div class="result-wrapper-logo">
    <img width="45%" src="assets/logo.svg" />
  </div>
</body>
<script>
  var fingerBox = document.getElementById('finger-box')
  var machineSound = document.getElementById('machine-sound')
  var countDown = document.getElementById('count-down')

  machineSound.onloadedmetadata = function() {
    var duration = 13
    countDown.innerHTML = duration

    var idInterval

    

    var startHandler = () => {
      fingerBox.classList.add('active')
      fingerBox.classList.add('active')
      machineSound.play()

      idInterval = setInterval(() => {
        duration -= 1
        countDown.innerHTML = duration

        if (duration === 0) {
          clearInterval(idInterval)
          fingerBox.onmousedown = null
          fingerBox.onmouseup = null
          fingerBox.classList.remove('active')
          machineSound.pause()
          window.location.href = 'result.html'
        }
      }, 1000)
    }

    var endHandler = () => {
      clearInterval(idInterval)
      fingerBox.classList.remove('active')
      machineSound.pause()
    }

    fingerBox.addEventListener('touchstart', startHandler)
    fingerBox.onmousedown = startHandler

    fingerBox.addEventListener('touchend', endHandler)
    fingerBox.onmouseup = endHandler
  }
</script>
</html>
